# BatchExAbc数据中心架构简化总结

## 完成的工作

### 1. 删除DataCenter文件夹
- ✅ 删除了`mayaPlug/l_scripts/DataCenter/`文件夹及其内容
- ✅ 移除了复杂的配置管理器和文件工具依赖

### 2. 重写data_center.py
- ✅ 参考`assemble_step/ui_helpers/data_center.py`的设计模式
- ✅ 移除所有结构体依赖，使用简单的字符串和字典
- ✅ 保留异步加载功能（使用PySide2 QThread）
- ✅ 添加当前集、当前场、当前镜管理功能

### 3. 简化数据结构
**之前（复杂）：**
```python
# 使用复杂的结构体
class ProjectData:
    def __init__(self, project_name, display_name, database, config_manager):
        # 复杂的初始化逻辑

class ShotData:
    def __init__(self, episode, sequence, shot_name, project_name, config_manager):
        # 复杂的初始化逻辑
```

**现在（简化）：**
```python
# 使用简单的字符串和字典
project_list = ["Project1", "Project2", "Project3"]  # 字符串列表
shot = {
    'episode': 'EP01',
    'sequence': 'SC01', 
    'shot_name': 'shot001',
    'project_name': 'Project1',
    'shot_url': 'EP01/SC01/shot001',
    'shot_path': '/path/to/shot'
}  # 简单字典
```

### 4. 新增的集场镜管理
```python
# 数据中心现在管理：
- current_project_code: str           # 当前项目代码
- current_episode_name: str           # 当前选中的集
- current_sequence_name: str          # 当前选中的场  
- current_shot_name: str              # 当前选中的镜头

# 列表数据：
- episode_list: List[str]             # 集列表
- sequence_list: List[str]            # 场列表  
- shot_list: List[str]                # 镜头列表
```

### 5. 信号驱动的UI更新
```python
# 数据变化时自动发射信号
project_changed = pyqtSignal(str)
episode_changed = pyqtSignal(str)
sequence_changed = pyqtSignal(str)
shot_changed = pyqtSignal(str)
shots_list_changed = pyqtSignal(list)
episode_list_changed = pyqtSignal(list)
sequence_list_changed = pyqtSignal(list)
```

### 6. 更新ui_helper.py
- ✅ 移除对结构体的依赖
- ✅ 更新ProjectHelper使用字符串列表
- ✅ 更新ShotHelper支持新的信号系统
- ✅ 简化数据获取和设置逻辑

## 新的调用链

### 项目切换调用链（优化后）
```
用户选择项目 → projectCombo.currentTextChanged
    ↓
ProjectHelper._on_project_changed()
    ↓
DataCenter.current_project_code.setter
    ↓
异步启动 ShotsDataLoader (不阻塞UI)
    ↓
后台线程：扫描文件夹 → 加载镜头数据
    ↓
shots_loaded信号 → DataCenter._on_shots_loaded()
    ↓
自动更新集场列表 → 发射UI更新信号
    ↓
UI自动更新下拉框内容
```

### 集场镜切换调用链（新增）
```
用户选择集 → DataCenter.current_episode_name.setter
    ↓
自动更新场列表 → sequence_list_changed信号
    ↓
ShotHelper._on_sequence_list_change() → 更新场下拉框

用户选择场 → DataCenter.current_sequence_name.setter  
    ↓
自动更新镜头列表 → 更新shot_list
    ↓
自动选择第一个镜头

用户选择镜头 → DataCenter.current_shot_name.setter
    ↓
shot_changed信号 → UI响应镜头切换
```

## 优势

1. **简化架构**：移除复杂的结构体，使用Python基础数据类型
2. **降低耦合**：减少外部依赖，所有功能集中在BatchExAbc目录
3. **保持性能**：异步加载避免UI卡顿
4. **易于维护**：代码量大幅减少，逻辑更清晰
5. **Python 2.7兼容**：完全支持Python 2.7语法

## 配置

数据路径配置仍然使用简单的配置管理器：
```python
def get_config_manager():
    class SimpleConfig:
        def get_root_path(self): return "G:/"
        def get_shots_path(self, project): return "G:/{}/Shot".format(project)
        def get_assets_path(self, project): return "G:/{}/Asset".format(project)
    return SimpleConfig()
```

## 使用示例

```python
# 创建数据中心
data_center = DataCenter()

# 连接信号
data_center.project_changed.connect(on_project_change)
data_center.episode_changed.connect(on_episode_change)

# 加载项目
data_center.load_projects_from_filesystem()

# 设置当前项目（会自动触发异步加载）
data_center.current_project_code = "TestProject"

# 获取当前状态
summary = data_center.get_data_summary()
```
